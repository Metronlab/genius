# Genius

A golang generative framework that palliate the lack of generic in go.

It's for now a fork / package of https://github.com/influxdata/influxdb/tree/master/tools/tmpl 
It removes support for .json comments which is an unsafe / non IDE-proof way to derive from json specs.
It will add YAML support asap to give comments possibility on data feeding the generation.

## Usage

Usage is inspired by test package

After installing genius with `go get` or `go install`, use a `go generate` directive:
```go
package yourpackage

//go:generate genius -data=YOUR_DEFINITIONS.json NAME_OF_YOUR_GO_FILE_TO_GENERATE.gen.go.tmpl
```

Your YOUR_DEFINITIONS.json should look like so:
```json
[
	{
		"name":"float64"
	},
	{
		"name":"int"
	},
       ...
]
```

Write the tmpl file in NAME_OF_YOUR_GO_FILE_TO_GENERATE.gen.go.tmpl, all golang tmpl directive are allowed:

```go
package test

import (
	"fmt"
	"reflect"
	"github.com/spf13/cast"
)

func ConvertToReflectKind(kind reflect.Kind, value interface{}) {
	switch kind {
		{{range .In}} // range against the provided definitions
		{{ $Type := print .name | stringsTitle }}
		case reflect.{{ $Type }}:
			fmt.Println("{{ .name }}", cast.To{{ $Type }}(value))
		{{end}}
		default:
			panic(fmt.Errorf("unhandled type %v", kind))
	}
}
```
Generated code in NAME_OF_YOUR_GO_FILE_TO_GENERATE.gen.go will look like:
```go
// Code generated by NAME_OF_YOUR_GO_FILE_TO_GENERATE.gen.go.tmpl. DO NOT EDIT.

package test

import (
	"fmt"
	"github.com/spf13/cast"
	"reflect"
)

func ConvertToReflectKind(kind reflect.Kind, value interface{}) {
	switch kind {

	case reflect.Float64:
		fmt.Println("float64", cast.ToFloat64(value))

	case reflect.Int:
		fmt.Println("int", cast.ToInt(value))

        ...

	default:
		panic(fmt.Errorf("unhandled type %v", kind))
	}
}
```
